<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Changelog • naomi</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Changelog"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-news">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">naomi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.9.27</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/data-model.html">Naomi data model</a>
    </li>
    <li>
      <a href="../articles/model-workflow.html">Naomi Model Workflow Example</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
      <h1 data-toc-skip>Changelog <small></small></h1>
      
    </div>

    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.27" id="naomi-2927">naomi 2.9.27<a class="anchor" aria-label="anchor" href="#naomi-2927"></a></h2>
<ul><li>Show calibration plot ratio values to nearest 0.1.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.26" id="naomi-2926">naomi 2.9.26<a class="anchor" aria-label="anchor" href="#naomi-2926"></a></h2>
<ul><li>Change wording of false convergence error to more informative warning.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.25" id="naomi-2925">naomi 2.9.25<a class="anchor" aria-label="anchor" href="#naomi-2925"></a></h2>
<ul><li>Suppress warning raised from duckdb shutdown</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.24" id="naomi-2924">naomi 2.9.24<a class="anchor" aria-label="anchor" href="#naomi-2924"></a></h2>
<ul><li>Migrate to github actions</li>
<li>Fix R CMD check notes</li>
<li>Unpin duckdb version</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.23" id="naomi-2923">naomi 2.9.23<a class="anchor" aria-label="anchor" href="#naomi-2923"></a></h2>
<ul><li>Update Datim UIDs for Ethiopia 2024 boundary division.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.22" id="naomi-2922">naomi 2.9.22<a class="anchor" aria-label="anchor" href="#naomi-2922"></a></h2>
<ul><li>Add missing Datim UIDs for Uganda corresponding to 146 districts.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.21" id="naomi-2921">naomi 2.9.21<a class="anchor" aria-label="anchor" href="#naomi-2921"></a></h2>
<ul><li>Fix a bug in Spectrum file generation when two surveys are selected for ART coverage (naomi troubleshooting issue #2024-122).</li>
<li>Fix a bug in comparison report generation when ANC prevalence not set for time 1.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.20" id="naomi-2920">naomi 2.9.20<a class="anchor" aria-label="anchor" href="#naomi-2920"></a></h2>
<ul><li>Update ART aggregation code to speed up data generation.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.19" id="naomi-2919">naomi 2.9.19<a class="anchor" aria-label="anchor" href="#naomi-2919"></a></h2>
<ul><li>Add optional <code>vmmc_path</code> to Spectrum download function for path to DMMPT2 output Excel file.</li>
<li>Add DMMPT2 outputs to PEPFAR Datapack CSV download, if DMMPT2 output file exists.</li>
<li>Silence <code>spdep v1.2-8</code> warnings from <code>mat2listw()</code> (issue #421).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.18" id="naomi-2918">naomi 2.9.18<a class="anchor" aria-label="anchor" href="#naomi-2918"></a></h2>
<ul><li>Change PEPFAR Data Pack file name to <code>pepfar_datapack_indicators_2024.csv</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.17" id="naomi-2917">naomi 2.9.17<a class="anchor" aria-label="anchor" href="#naomi-2917"></a></h2>
<ul><li>Bump version of naomi.options v1.2.0 to include defaults for 2024 HIV estimates
<ul><li>Extends calendar quarter model options drop downs from <code>December 2025</code> to <code>December 2027</code>
</li>
<li>Updates T2, T3, T4, and T5 defaults all 1-year ahead</li>
<li>Updates default ‘current’ ANC input year to 2023</li>
<li>Updates TZA defaults to 2022 PHIA survey</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.16" id="naomi-2916">naomi 2.9.16<a class="anchor" aria-label="anchor" href="#naomi-2916"></a></h2>
<ul><li>Change programme data aggregation scripts to aggregate and tag missing data. Changes in the outputs of the following functions:
<ul><li>
<code><a href="../reference/aggregate_art.html">aggregate_art()</a></code> and <code><a href="../reference/aggregate_anc.html">aggregate_anc()</a></code>: Data aggregated retaining missing values at lowest admin level and summed totals at higher admin levels.</li>
<li>
<code><a href="../reference/prepare_input_time_series_art.html">prepare_input_time_series_art()</a></code> and <code><a href="../reference/prepare_input_time_series_anc.html">prepare_input_time_series_anc()</a></code>: New column containing a list of area_ids corresponding to missing districts included in aggreagated totals.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.15" id="naomi-2915">naomi 2.9.15<a class="anchor" aria-label="anchor" href="#naomi-2915"></a></h2>
<ul><li>Add placeholder function <code>hintr_prepare_agyw_download</code> for creating AGYW tool.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.14" id="naomi-2914">naomi 2.9.14<a class="anchor" aria-label="anchor" href="#naomi-2914"></a></h2>
<ul><li>Fix scrambled translation keys in summary report.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.13" id="naomi-2913">naomi 2.9.13<a class="anchor" aria-label="anchor" href="#naomi-2913"></a></h2>
<ul><li>Ensure duckdb connection is readonly.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.12" id="naomi-2912">naomi 2.9.12<a class="anchor" aria-label="anchor" href="#naomi-2912"></a></h2>
<ul><li>Automatically set T4 and T5 to 24- and 36-months ahead of T3 if not specified in model options.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.11" id="naomi-2911">naomi 2.9.11<a class="anchor" aria-label="anchor" href="#naomi-2911"></a></h2>
<ul><li>hintr data frame outputs can now be saved as a duckdb database.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.10" id="naomi-2910">naomi 2.9.10<a class="anchor" aria-label="anchor" href="#naomi-2910"></a></h2>
<ul><li>Update PJNZ extraction for adult ART need Dec 31 for 2023 PJNZ files. Previously child ART was note recorded in the .DP file tag <code>&lt;NeedARTDec31 MV&gt;</code>, and so it was fine to extract the total value. Now child ART is recorded, and so need to sum the adult age groups only.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.9" id="naomi-299">naomi 2.9.9<a class="anchor" aria-label="anchor" href="#naomi-299"></a></h2>
<ul><li>Add indicators <code>aware_plhiv_attend</code> and <code>unaware_plhiv_attend</code> for consistent facility attendance cascades.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.8" id="naomi-298">naomi 2.9.8<a class="anchor" aria-label="anchor" href="#naomi-298"></a></h2>
<ul><li>Display PLHIV number indicators to nearest 1.</li>
<li>Drop input time series indicator “ART proportion &lt;15” nd “ART adult-to-child ratio” in favour of “ART child-to-adult ratio” indicator.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.7" id="naomi-297">naomi 2.9.7<a class="anchor" aria-label="anchor" href="#naomi-297"></a></h2>
<ul><li>Change default PEPFAR PSNU level for Namibia to level 1 (Region / Health Province).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.6" id="naomi-296">naomi 2.9.6<a class="anchor" aria-label="anchor" href="#naomi-296"></a></h2>
<ul><li>Fix for comparison report failing to render when ANC data included at T1 in a different year to model T1. This fix will prevent ANC comparison plots for T1 from rendering in this case.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.5" id="naomi-295">naomi 2.9.5<a class="anchor" aria-label="anchor" href="#naomi-295"></a></h2>
<ul><li>Fix translation of output descriptions which are used as the resource description for files uploaded to the ADR.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.4" id="naomi-294">naomi 2.9.4<a class="anchor" aria-label="anchor" href="#naomi-294"></a></h2>
<ul><li>Implement Spectrum ART scaling adjustment in Naomi calibration.</li>
<li>Add PEPFAR area ID mapping for Ethiopia.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.3" id="naomi-293">naomi 2.9.3<a class="anchor" aria-label="anchor" href="#naomi-293"></a></h2>
<ul><li>Update PEPFAR Datim UID mapping for CMR.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.2" id="naomi-292">naomi 2.9.2<a class="anchor" aria-label="anchor" href="#naomi-292"></a></h2>
<ul><li>INTERNAL ONLY: Update code to silence warning messages from dplyr v1.1.0. No changes to model or interface.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.1" id="naomi-291">naomi 2.9.1<a class="anchor" aria-label="anchor" href="#naomi-291"></a></h2>
<ul><li>Update PEPFAR Datim UID mapping and PSNU level for 2023 Target Setting Tool.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.9.0" id="naomi-290">naomi 2.9.0<a class="anchor" aria-label="anchor" href="#naomi-290"></a></h2>
<ul><li><p>Add projection to T4 and T5 for PEPFAR COP projections. Only outputs plhiv, plhiv_attend, and infections, and, for T4, incidence.</p></li>
<li><p>Update indicators and age groups for PEPFAR Data Pack export to 2023 specification.</p></li>
<li><p>Change PEPFAR Data Pack file name to <code>pepfar_datapack_indicators_2023.csv</code>.</p></li>
<li><p>Add higher area levels to PEPFAR Datim ID mapping table to enable alternate PSNU level selection.</p></li>
<li><p>Add advanced model option to select PEPFAR PSNU level to produce Data Pack output. Defaults set to current choices.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.17" id="naomi-2817">naomi 2.8.17<a class="anchor" aria-label="anchor" href="#naomi-2817"></a></h2>
<ul><li>Patch NULL checking code in <code>summary_report.Rmd</code> and <code>comparison_report.Rmd</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.16" id="naomi-2816">naomi 2.8.16<a class="anchor" aria-label="anchor" href="#naomi-2816"></a></h2>
<ul><li>Don’t include ART plots in comparison report download when model fit with an ART calendar quarter different to t1 (issue 41).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.15" id="naomi-2815">naomi 2.8.15<a class="anchor" aria-label="anchor" href="#naomi-2815"></a></h2>
<ul><li>Don’t include prevalence plots in comparison report download when model fit with survey aggregate data (issue 36).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.14" id="naomi-2814">naomi 2.8.14<a class="anchor" aria-label="anchor" href="#naomi-2814"></a></h2>
<ul><li>Show comparison barchart ratios to 1 decimal point accuracy.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.13" id="naomi-2813">naomi 2.8.13<a class="anchor" aria-label="anchor" href="#naomi-2813"></a></h2>
<ul><li>Generate comparison report where no survey ART coverage is available</li>
<li>Consistent age/sex descriptions in comparison plot titles.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.12" id="naomi-2812">naomi 2.8.12<a class="anchor" aria-label="anchor" href="#naomi-2812"></a></h2>
<ul><li>Handle case when multiple .shiny90 files found in .PJNZ file. Choose the file with the shortest file name. This will most likely be the file that Spectrum fitter has saved.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.11" id="naomi-2811">naomi 2.8.11<a class="anchor" aria-label="anchor" href="#naomi-2811"></a></h2>
<ul><li>Do not attempt to extract .shiny90 data if option <code>output_aware_plhiv</code> = “No”.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.10" id="naomi-2810">naomi 2.8.10<a class="anchor" aria-label="anchor" href="#naomi-2810"></a></h2>
<ul><li>Don’t raise warning for not selecting ART attending when ART data is excluded at T1 and T2</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.9" id="naomi-289">naomi 2.8.9<a class="anchor" aria-label="anchor" href="#naomi-289"></a></h2>
<ul><li>Fix comparison bar plot error bars and filters.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.8" id="naomi-288">naomi 2.8.8<a class="anchor" aria-label="anchor" href="#naomi-288"></a></h2>
<ul><li>Update bug in <code><a href="../reference/art_spectrum_warning.html">art_spectrum_warning()</a></code> and <code><a href="../reference/anc_spectrum_warning.html">anc_spectrum_warning()</a></code> where district totals in naomi were compared to national totals in spectrum.</li>
<li>Changes warning to compare district totals as opposed to district age sex totals to avoid excluding comparisons when age/sex dissagreagtes are different in spectrum and naomi data.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.7" id="naomi-287">naomi 2.8.7<a class="anchor" aria-label="anchor" href="#naomi-287"></a></h2>
<ul><li>Show ANC prevalence on ANC time series to 1 decimal place instead of 2. It will now be consistent with prevalence in other plots.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.6" id="naomi-286">naomi 2.8.6<a class="anchor" aria-label="anchor" href="#naomi-286"></a></h2>
<ul><li>
<code>hintr_run_model</code> data can include a <code>resource_url</code> to include a static link to the original resource.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.5" id="naomi-285">naomi 2.8.5<a class="anchor" aria-label="anchor" href="#naomi-285"></a></h2>
<p>No user-visible changes, only internal.</p>
<ul><li>Update <code><a href="../reference/extract_shiny90_age_sex.html">extract_shiny90_age_sex()</a></code> to extract awareness of status estimates saved with Spectrum internal Shiny90 implementation (Spectrum v6.21).</li>
<li>Added test file with internally created .shiny90 file: <code>extdata/demo_mwi2019_v6.21-shiny90.PJNZ</code>
</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.4" id="naomi-284">naomi 2.8.4<a class="anchor" aria-label="anchor" href="#naomi-284"></a></h2>
<ul><li>Make comparison report handle cases where the user selects only 1 survey for prevalence.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.3" id="naomi-283">naomi 2.8.3<a class="anchor" aria-label="anchor" href="#naomi-283"></a></h2>
<ul><li>Update model fit to fallback to <code>anchor_home_district = TRUE</code> if option is not set.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.2" id="naomi-282">naomi 2.8.2<a class="anchor" aria-label="anchor" href="#naomi-282"></a></h2>
<ul><li>Add model option to specify a new structure for ART attending random effects. In this change, the random effect for the home district applies to residents in that district (and in the neighbouring districts). This means that, for example, if a district is “attractive” to residents of neighbouring districts, it will also be more attractive to residents in that district to stay there, rather than go to a neighbouring district. In the previous specification of the model, the ART attending district parameter only applied to residents of neighbouring districts.</li>
<li>This is now the default model specification with <code>options$anchor_home_district = TRUE</code>
</li>
<li>The model can be reverted to the previous specification with `<code>options$anchor_home_district = FALSE</code>
</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.1" id="naomi-281">naomi 2.8.1<a class="anchor" aria-label="anchor" href="#naomi-281"></a></h2>
<ul><li>Fix <code><a href="../reference/aggregate_art.html">aggregate_art()</a></code> to aggregate ART separately when provide at different admin levels. Previous behaviour was to aggregate from lowest level provided.</li>
<li>Add tests and adjusts aggregation scripts to account for missing ART and ANC data inputs:
<ul><li>Data provided at multiple levels for the same years</li>
<li>Data provided at more than one level for different years</li>
<li>Data missing for some sub-national units at one time point</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.8.0" id="naomi-280">naomi 2.8.0<a class="anchor" aria-label="anchor" href="#naomi-280"></a></h2>
<ul><li>Save model and calibration output from <code>hintr_run_model</code> and <code>hintr_calibrate</code> as qs files for faster reading. See <a href="https://github.com/traversc/qs" class="external-link uri">https://github.com/traversc/qs</a>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.19" id="naomi-2719">naomi 2.7.19<a class="anchor" aria-label="anchor" href="#naomi-2719"></a></h2>
<ul><li>Vectorise <code>quarter_id_to_calendar_quarter</code> conversion functions.</li>
<li>Load <code>get_metadata</code> into memory on first retrieval for quicker repeated access from other packages.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.18" id="naomi-2718">naomi 2.7.18<a class="anchor" aria-label="anchor" href="#naomi-2718"></a></h2>
<p>Update for Spectrum v6.2 with calendar year projection period instead of mid-year projection.</p>
<ul><li><p>Requires <code>eppasm &gt;= 0.7.0</code> and <code>first90 &gt;= 1.6.1</code> which incorporate code updates for calendar year projection.</p></li>
<li><p>Add demo PJNZ files saved in Spectrum 6.2 beta 29.</p></li>
<li><p>For Spectrum inputs parsed by function <code><a href="../reference/extract_pjnz_naomi.html">extract_pjnz_naomi()</a></code>, add a column specifying to which calendar quarter the outputs correspond. This enables Naomi model compatibility with either mid-year projection (Spectrum version &lt;=6.19) or calendar year projections (Spectrum version &gt;=6.2).</p></li>
<li><p>Update <code>read_dp_anc_testing()</code> for new ANC testing data input tag in .DP file <code>"&lt;ANCTestingValues MV4&gt;"</code>.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.17" id="naomi-2717">naomi 2.7.17<a class="anchor" aria-label="anchor" href="#naomi-2717"></a></h2>
<ul><li>Error if trying to generate comparison report with old model output</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.16" id="naomi-2716">naomi 2.7.16<a class="anchor" aria-label="anchor" href="#naomi-2716"></a></h2>
<ul><li>Add function to generate html report comparing naomi model estimates with input data:
<ul><li>The comparison report is generated with the function <code><a href="../reference/generate_comparison_report.html">generate_comparison_report()</a></code> that requires a naomi output file saved as an .Rds or output zip file created by <code><a href="../reference/hintr_run_model.html">hintr_run_model()</a></code>
</li>
<li>The report calls exported plotting functions that will generate interactive plotly figures from the <code>inputs_outputs</code> dataset in the naomi outputs including <code><a href="../reference/bar_plotly.html">bar_plotly()</a></code>, <code><a href="../reference/age_bar_plotly.html">age_bar_plotly()</a></code> and <code>scatter_plotly</code>.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.15" id="naomi-2715">naomi 2.7.15<a class="anchor" aria-label="anchor" href="#naomi-2715"></a></h2>
<ul><li>Add and known negative and births facility inicators to input time series</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.14" id="naomi-2714">naomi 2.7.14<a class="anchor" aria-label="anchor" href="#naomi-2714"></a></h2>
<ul><li>Fix comparison barchart ANC age matched indicators, these were pointing to the wrong indicator data.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.13" id="naomi-2713">naomi 2.7.13<a class="anchor" aria-label="anchor" href="#naomi-2713"></a></h2>
<ul><li>Add input time series indicator showing ratio of ANC births to ANC clients</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.12" id="naomi-2712">naomi 2.7.12<a class="anchor" aria-label="anchor" href="#naomi-2712"></a></h2>
<ul><li>Fix name and tooltip of <code>art_adult_child_ratio</code> indicator. This is ratio of adults to children not paediatric sex ratio.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.11" id="naomi-2711">naomi 2.7.11<a class="anchor" aria-label="anchor" href="#naomi-2711"></a></h2>
<ul><li>Remove <code>get_calibration_option_labels()</code>, <code>get_model_calibration_options()</code> and <code>get_model_options_template()</code>. Model options specification has been refactored into naomi.options package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.10" id="naomi-2710">naomi 2.7.10<a class="anchor" aria-label="anchor" href="#naomi-2710"></a></h2>
<ul><li>Subset model options in <code>naomi_fit</code> object do not contain advanced options. Updates <code><a href="../reference/save_output_package.html">read_output_package()</a></code> function to read in full model options when available in the model output zip</li>
<li>Adds README to output zip describing outputs zip files</li>
<li>Add backwards compatibility for old versions of coarse output zip</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.9" id="naomi-279">naomi 2.7.9<a class="anchor" aria-label="anchor" href="#naomi-279"></a></h2>
<ul><li>Add country name and ISO3 code to <code>extract_pjnz_one()</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.8" id="naomi-278">naomi 2.7.8<a class="anchor" aria-label="anchor" href="#naomi-278"></a></h2>
<ul><li>Add indicator <code>plhiv_attending</code> reporting the estimated denominator for <code>art_current</code> based on assuming same ART attendance probabilities for untreated population as the treated population. This give estimates for the predicted number of PLHIV ‘in the ART catchment’ for a district and the number of untreated PLHIV in the catchment. This is an effort to address the recurring issue that the TX_CURR value that is provided to Data Pack does not correspond to the district PLHIV denominator, and to provide an output more directly useful for setting a district treatment targets.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.7" id="naomi-277">naomi 2.7.7<a class="anchor" aria-label="anchor" href="#naomi-277"></a></h2>
<ul><li>Report log likelihood in model fit object.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.6" id="naomi-276">naomi 2.7.6<a class="anchor" aria-label="anchor" href="#naomi-276"></a></h2>
<ul><li>
<code><a href="../reference/hintr_comparison_plot.html">hintr_comparison_plot()</a></code> will error if comparison plot data does not exist. This will avoid a class of obscure errors being shown to end user.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.5" id="naomi-275">naomi 2.7.5<a class="anchor" aria-label="anchor" href="#naomi-275"></a></h2>
<ul><li>
<p>Adjust incidence projection for changing incidence trend between T1 and T2.</p>
<p>Previously, new infections by age were calculated as: <code>(1 - exp(-lambda_t1 * duration)) * hiv_negative_t1</code>. This implicitly assumed that incidence rate and HIV negative population size were constant over the period from T1 to T2. This was reasonably okay for short periods, but less acceptable when time from T1 to T2 becomes many years. In settings with declining infections, this approach will tend to over-estimate the number of PLHIV at T2.</p>
<p>New approach calculates infections in one year by age and sex based on <code>lambda_t1</code> and then extrapolates to the number of infections between T1 and T2 based on the ratio of the number of infections occurring in Spectrum between T1 and T2 to the number of infections in the year preceding T1 (Spectrum definition for infections). This calculation also accounts for the number progressing from the age group at infection to the age group at T2 based on Spectrum infections by cohort (same as previous implementation).</p>
<p>The model accounts for impact of different ART coverage levels at T1 on district-level transmission rate and incidence, but does not account for differential change in ART coverage between T1 and T2. That is, a larger scale-up in ART in district A than district B between T1 and T2 would not result in a larger relative decline in incidence in A than B during this period.</p>
<p>The model does not explicitly account for mortality among infections between T1 and T2, but this is implicitly handled how new infections are subtracted away from the cohort survival probabilities for PLHIV at baseline.</p>
<p>Better handling of incidence changes over time and mortality probably need a more complete simulation model rather than the single time jump approximation.</p>
</li>
<li>
<p>Related to the previous change:</p>
<ul><li>The age-specific incidence rate for distributing - The age-specific incidence rate for distributingnew infections by age (<code>spec_incid_t1</code>, etc. in the result of <code><a href="../reference/naomi_model_frame.html">naomi_model_frame()</a></code>) uses <em>current year</em> HIV negative population as denominator instead of <em>previous year</em> HIV negative population as denominator (used by Spectrum). This is for consistency with current time population denominator used in internal incidence simulation.</li>
<li>Infections are gradauted to quarters over <em>periods</em> rather than by <em>cohort</em> such that all infections remain within the same age as they are reported in single-age Spectrum outputs. Graduation is done via monotonic (Hyman) smoothing on cumulative infections.</li>
</ul></li>
<li><p>Handle adjacency matrix construction for case with single area.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.4" id="naomi-274">naomi 2.7.4<a class="anchor" aria-label="anchor" href="#naomi-274"></a></h2>
<ul><li>Re-fetch meta data when output zip is generated so that output zip contents in <code>indicators.csv</code> and <code>meta_*.csv</code> are in the language selected by the user at the time of generation.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.3" id="naomi-273">naomi 2.7.3<a class="anchor" aria-label="anchor" href="#naomi-273"></a></h2>
<ul><li>Patch <code><a href="../reference/aggregate_anc.html">aggregate_anc()</a></code> and <code><a href="../reference/aggregate_art.html">aggregate_art()</a></code>: select required columns when joining to prevent inadvertent column name clash due to extra columns (e.g. <code>area_level</code>).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.2" id="naomi-272">naomi 2.7.2<a class="anchor" aria-label="anchor" href="#naomi-272"></a></h2>
<ul><li>Restructure functions that subset model input data based on logic in model options:</li>
<li>In <code><a href="../reference/select_naomi_data.html">select_naomi_data()</a></code>: Provide an annotated version of all input data provided with data tagged as <code>raw_included</code>, <code>raw_excluded</code> and <code>interpolated_inlcuded</code>. Individual data frames for survey, ART and ANC inputs are added to <code>naomi-data</code> in a list named <code>full_data</code>.</li>
<li>In <code><a href="../reference/output_package.html">output_package()</a></code>: Create a long dataframe containing matched data inputs and model outputs with <code>align_inputs_output()</code>. This adds a new object to the naomi output package that may used to compare model estimates and data inputs for T1 and T2.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.1" id="naomi-271">naomi 2.7.1<a class="anchor" aria-label="anchor" href="#naomi-271"></a></h2>
<ul><li>If <code>births_facility</code> in ANC data is missing it will be replaced by <code>NA</code> when reading input so input time series aggregation passes</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.7.0" id="naomi-270">naomi 2.7.0<a class="anchor" aria-label="anchor" href="#naomi-270"></a></h2>
<p>Updates for 2023 UNAIDS estimates (Dec 2022 - Mar 2023).</p>
<ul><li>Add fields to ANC routine testing data specification and example data sets:
<ul><li>
<code>anc_known_neg</code>: Number of women who were not tested for HIV at antenatal visit because they had a recent documented HIV negative test.
<ul><li>This is only recorded by some countries HMIS. The column may be missing or blank if this is not captured within national ANC testing guidelines and reporting.</li>
<li>If the column is missing or <code>NA</code> in data input, it will be replaced by values <code>0</code> in reading input.</li>
<li>Value <code>anc_known_neg</code> is added to denominator for calcuating <code>anc_prevalence</code>.</li>
</ul></li>
<li>
<code>births_facility</code>: The number of live births recorded at health facilities. This is added for triangulation with trend in number of ANC visits for data review purposes. Currently not used in modelling.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.28" id="naomi-2628">naomi 2.6.28<a class="anchor" aria-label="anchor" href="#naomi-2628"></a></h2>
<ul><li>Patch for incidence input argument in EPP-ASM simulation for <code>eppasm_v0.6.2</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.27" id="naomi-2627">naomi 2.6.27<a class="anchor" aria-label="anchor" href="#naomi-2627"></a></h2>
<ul><li>Move ANC and ART spectrum data mismatch warnings to be shown on model calibrate and review result pages</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.26" id="naomi-2626">naomi 2.6.26<a class="anchor" aria-label="anchor" href="#naomi-2626"></a></h2>
<ul><li>
<code>hintr_prepare_spectrum_download</code> now takes arg <code>notes</code> for arbitrary notes which will be added into the output zip</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.25" id="naomi-2625">naomi 2.6.25<a class="anchor" aria-label="anchor" href="#naomi-2625"></a></h2>
<ul><li>Fix anc aggregation</li>
<li>Add tests for aggregation and time series inouts scripts to ensure unique strata</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.24" id="naomi-2624">naomi 2.6.24<a class="anchor" aria-label="anchor" href="#naomi-2624"></a></h2>
<ul><li>Add <code>hintr_prepare_comparison_report_download</code> function to generate comparison summary report</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.23" id="naomi-2623">naomi 2.6.23<a class="anchor" aria-label="anchor" href="#naomi-2623"></a></h2>
<ul><li>Add area hierarchy into time series plot data</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.22" id="naomi-2622">naomi 2.6.22<a class="anchor" aria-label="anchor" href="#naomi-2622"></a></h2>
<ul><li>Ignore non PJNZ files when listing contents of uploaded zip, to stop naomi trying to read from __MACOSX folder that macs add to zip files</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.21" id="naomi-2621">naomi 2.6.21<a class="anchor" aria-label="anchor" href="#naomi-2621"></a></h2>
<ul><li>Add warning for spectrum totals that do not match aggregated district ART + ANC data</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.19" id="naomi-2619">naomi 2.6.19<a class="anchor" aria-label="anchor" href="#naomi-2619"></a></h2>
<ul><li>Specify incidence per 1000 outputs to be displayed with one decimal place.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.18" id="naomi-2618">naomi 2.6.18<a class="anchor" aria-label="anchor" href="#naomi-2618"></a></h2>
<ul><li>Bug fix: calibration options read into summary report from <code>outputs</code> object</li>
<li>Add test to ensure calibration options are read into summary report correctly if present</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.17" id="naomi-2617">naomi 2.6.17<a class="anchor" aria-label="anchor" href="#naomi-2617"></a></h2>
<ul><li>Add PEPFAR Datim PSNU UID for Benin.</li>
<li>Change default population calibration option selection to “Subnational”. If a national file is loaded, it will simply calibrate the national file.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.16" id="naomi-2616">naomi 2.6.16<a class="anchor" aria-label="anchor" href="#naomi-2616"></a></h2>
<ul><li>Bug fix: remove duplicate addition of CLHIV in T2 projection arising from paediatric incidence. This was introduced in v2.6.0 when paediatric new infections were added to the outputs.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.15" id="naomi-2615">naomi 2.6.15<a class="anchor" aria-label="anchor" href="#naomi-2615"></a></h2>
<ul><li>Add PEPFAR Datim UID for Burundi.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.14" id="naomi-2614">naomi 2.6.14<a class="anchor" aria-label="anchor" href="#naomi-2614"></a></h2>
<ul><li><p>Add option for district-sex-time interaction for ART coverage. This is implemented by argument <code>naomi_model_frame(..., alpha_xst_term = TRUE, ...)</code>. The default is currently <code>alpha_xst_term = FALSE</code> for backwards compatibility. If set to <code>TRUE</code>, the model also checks that sex-stratified ART data are included at both T1 and T2.</p></li>
<li>
<p>Add term to PLHIV projection from T1 to T2 and T2 to T3 to account for district-level net migration. The term is the ratio of the change in the cohort population at district level divided by the national level cohort change. The national level cohort change from Spectrum accounts for mortality and international net migration.</p>
<p>Applying the ratio is controlled by the argument <code>adjust_area_growth = TRUE</code> to <code><a href="../reference/naomi_model_frame.html">naomi_model_frame()</a></code>.</p>
<p><strong>This is currently set as <code>FALSE</code> by default.</strong> Pending further testing in problematic cases.</p>
<p>Limitations of this approach: (1) It does not explicitly account for migration of PLHIV between districts. Therefore, it may ‘create’ or ‘dissolve’ infections if net population growth is greater in high prevalence districts (and vice versa). This is consistent with Spectrum and EPP handling of migration, but implications could be larger for smaller subnational areas. (2) In some cases, these net migration ratios mask unrealistic demographic assumptions in subnational population data (rather than true net migration patterns).</p>
</li>
</ul><p><em>Internal changes</em></p>
<ul><li>Refactor function <code>create_Lproj()</code> to avoid replicating same code for T1 -&gt; T2 and T2 -&gt; T3 projection.</li>
<li>Remove conversion of <code>sf</code> to <code>sp</code> object for <code><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">spdep::poly2nb()</a></code>, which now supports <code>sf</code> objects from v1.0.</li>
<li>Replace “ART” in French and Portuguese strings with “TARV”.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.13" id="naomi-2613">naomi 2.6.13<a class="anchor" aria-label="anchor" href="#naomi-2613"></a></h2>
<ul><li><p>The model uses offsets from Spectrum to determine HIV prevalence in age groups outside the age range for which survey HIV prevalence are available. Stratify determination of offset age ranges by sex. This addresses situation for DHS surveys where maximum female age is 49 but maximum male age is 54 or 59.</p></li>
<li><p>Set default to model paediatric prevalence relative to adult female age 15-49 prevalence instead of using offsets relative to age 15-19 prevalence. This will (1) ensure same prevalence for male and female children, and (2) reduce distortions to age 15-19 prevalence arising from paediatric ART data.</p></li>
<li><p>Expose advanced option to allow paediatric to adult prevalence ratio to vary by district (option <code>rho_paed_x_term</code>).</p></li>
<li><p>Throw validation error if time-varying ART attendance is selected, but ART data are not included at both Time 1 and Time 2.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.12" id="naomi-2612">naomi 2.6.12<a class="anchor" aria-label="anchor" href="#naomi-2612"></a></h2>
<ul><li>Do not save the PEPFAR Data Pack CSV for coarse age output package because the five-year age group results are not included.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.11" id="naomi-2611">naomi 2.6.11<a class="anchor" aria-label="anchor" href="#naomi-2611"></a></h2>
<ul><li>Revert plot ordering change made in 2.6.9 in favour of changing the default selected to HIV prevalence from hintr.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.10" id="naomi-2610">naomi 2.6.10<a class="anchor" aria-label="anchor" href="#naomi-2610"></a></h2>
<ul><li>MOZ <code>area_id</code> in <code>inst/datapack/datapack_psnu_area_id_map.csv</code> to new area hierarchy with separate Maputo provinces at admin-2.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.9" id="naomi-269">naomi 2.6.9<a class="anchor" aria-label="anchor" href="#naomi-269"></a></h2>
<ul><li>Switch plot ordering to show HIV prevalence first.</li>
<li>Patch logic error in calibration table: use calibrated population (done pre model fitting) as denominator for raw prevalence denominator (troublshooting #2022-73)</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.8" id="naomi-268">naomi 2.6.8<a class="anchor" aria-label="anchor" href="#naomi-268"></a></h2>
<ul><li>Require <code>eppasm</code> v0.5.12 to avoid divide-by-zero in model computations (troubleshooting #2022-51).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.7" id="naomi-267">naomi 2.6.7<a class="anchor" aria-label="anchor" href="#naomi-267"></a></h2>
<ul><li>Increase threshold to trigger warning for HIV prevalence in naomi outputs.</li>
<li>Remove non-outputted indicators from <code>meta_indicator</code> table in the output package.</li>
<li>Add <code>anc_tested</code> and <code>anc_tested_pos</code> to anc time series plot.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.6" id="naomi-266">naomi 2.6.6<a class="anchor" aria-label="anchor" href="#naomi-266"></a></h2>
<ul><li>Add new infections output to PEPFAR data pack export.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.5" id="naomi-265">naomi 2.6.5<a class="anchor" aria-label="anchor" href="#naomi-265"></a></h2>
<ul><li>Add HIV incidence rate output to PEPFAR datapack export.</li>
<li>Add check <code>Cal_Population</code> for population calibration in UNAIDS Navigator checklist file.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.4" id="naomi-264">naomi 2.6.4<a class="anchor" aria-label="anchor" href="#naomi-264"></a></h2>
<ul><li>Bug fix: UNAIDS navigator checklist was not checking calibration stratification <code>= "sex_age_coarse"</code> for any indicators. Add this to check.</li>
<li>Return input time series data in <code>area_sort_order</code> order.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.3" id="naomi-263">naomi 2.6.3<a class="anchor" aria-label="anchor" href="#naomi-263"></a></h2>
<ul><li>Adds helper function <code><a href="../reference/output_naomi_warning.html">output_naomi_warning()</a></code> to report specific area/age/sex disaggregates that are triggering warnings in simulated outputs.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.2" id="naomi-262">naomi 2.6.2<a class="anchor" aria-label="anchor" href="#naomi-262"></a></h2>
<ul><li>Makes file reading utilities more robust replacing <code><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">readr::col_double()</a></code> with <code><a href="https://readr.tidyverse.org/reference/parse_number.html" class="external-link">readr::col_number()</a></code>
</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.1" id="naomi-261">naomi 2.6.1<a class="anchor" aria-label="anchor" href="#naomi-261"></a></h2>
<ul><li><p>Adds output age group 10-19 and 25-49 years.</p></li>
<li><p>Update TZA <code>area_id</code> in <code>inst/datapack/datapack_psnu_area_id_map.csv</code> to new area hierarchy with Zone level added.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.6.0" id="naomi-260">naomi 2.6.0<a class="anchor" aria-label="anchor" href="#naomi-260"></a></h2>
<ul><li><p>In construction of survivorship projection matrices, the method for interpolating annual population totals to quarter-year age group totals was revised to use Hyman monotonic interpolation of population counts for smoother population distributions.</p></li>
<li><p>Paediatric new infections (MTCT) are distributed to districts based on the ratio of paediatric incidence rate to adult 15-49 female HIV prevalence. This implicitly assumes the same mother-to-child transmission rate for all districts; results should be interpreted accordingly.</p></li>
<li><p>Spectrum inputs for number on ART at end of year (Dec 31) for age 0-14, male 15+, and female 15+ are read from the PJNZ and used for model calibration. As a result, if calibration to Spectrum outputs is applied, Q4 outputs for <code>art_current</code> will match exactly to Spectrum. ART coverage will not be exactly the same because Spectrum uses mid-year PLHIV for the denominator and Naomi uses end-year PLHIV for the denominator.</p></li>
</ul><p><em>Internal changes</em></p>
<ul><li>Added R version of the Naomi model in function [<code><a href="../reference/naomi_objective_function_r.html">naomi_objective_function_r()</a></code>] for stepping through model line by line.
<ul><li>
<code>REPORT()</code> values match C++ code exactly.</li>
<li>AR1 likelihood is not yet implemented so objective function value does not match the C++ version exactly.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.21" id="naomi-2521">naomi 2.5.21<a class="anchor" aria-label="anchor" href="#naomi-2521"></a></h2>
<ul><li>Patch to <code>summary_report.Rmd</code> to avoid spherical geometry aggregation error (troubleshooting #2022-43).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.20" id="naomi-2520">naomi 2.5.20<a class="anchor" aria-label="anchor" href="#naomi-2520"></a></h2>
<ul><li>Implement Navigator checks.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.19" id="naomi-2519">naomi 2.5.19<a class="anchor" aria-label="anchor" href="#naomi-2519"></a></h2>
<ul><li>Use standard file reading functions in input time series (troubleshooting #2022-41).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.18" id="naomi-2518">naomi 2.5.18<a class="anchor" aria-label="anchor" href="#naomi-2518"></a></h2>
<ul><li>Update EPP-ASM dependency to v0.5.11 with patch for reading version of .DP file (troubleshooting #2022-42).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.17" id="naomi-2517">naomi 2.5.17<a class="anchor" aria-label="anchor" href="#naomi-2517"></a></h2>
<ul><li>Update first90 package dependency to v1.5.1 for 2022 estimates.</li>
<li>Add UNAIDS Estimates Navigator checklist CSV to output package .zip.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.16" id="naomi-2516">naomi 2.5.16<a class="anchor" aria-label="anchor" href="#naomi-2516"></a></h2>
<ul><li>Update colour scales to match summary report and user feedback</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.15" id="naomi-2515">naomi 2.5.15<a class="anchor" aria-label="anchor" href="#naomi-2515"></a></h2>
<ul><li>Suppress s2 geometry in adjacency matrix construction.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.14" id="naomi-2514">naomi 2.5.14<a class="anchor" aria-label="anchor" href="#naomi-2514"></a></h2>
<ul><li>Add <code>naomi_warning</code> helper to raise warnings which can be displayed in front end</li>
<li>Return warnings from model fit, model calibration and model option validation</li>
<li>Remove <code>permissive</code> option from model options, warning now returned instead of error</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.13" id="naomi-2513">naomi 2.5.13<a class="anchor" aria-label="anchor" href="#naomi-2513"></a></h2>
<ul><li>Replace <code>get_plot_type_label_and_description</code> with <code>get_plot_type_column_metadata</code> and include formatting info in response</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.12" id="naomi-2512">naomi 2.5.12<a class="anchor" aria-label="anchor" href="#naomi-2512"></a></h2>
<ul><li>Small fixes to text in Naomi summary report</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.11" id="naomi-2511">naomi 2.5.11<a class="anchor" aria-label="anchor" href="#naomi-2511"></a></h2>
<ul><li>Update defaults for current estimates period to <code>CY2021Q4</code> (December 2021) and short-term projection quarter to <code>CY2022Q3</code> (September 2022).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.10" id="naomi-2510">naomi 2.5.10<a class="anchor" aria-label="anchor" href="#naomi-2510"></a></h2>
<ul><li>Change viral load indicators to <code>vl_tested_12mos</code> and <code>vl_suppressed_12mos</code> to specify that indicators are reported for the previous 12 months even if reporting period is quarterly.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.9" id="naomi-259">naomi 2.5.9<a class="anchor" aria-label="anchor" href="#naomi-259"></a></h2>
<ul><li>Fix to allow <code><a href="../reference/prepare_input_time_series_art.html">prepare_input_time_series_art()</a></code> to accept data without art_new and vls indicators provided</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.8" id="naomi-258">naomi 2.5.8<a class="anchor" aria-label="anchor" href="#naomi-258"></a></h2>
<ul><li>Add <em>simulated</em> viral load testing data to example datasets.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.7" id="naomi-257">naomi 2.5.7<a class="anchor" aria-label="anchor" href="#naomi-257"></a></h2>
<ul><li><p>Throw an error from <code><a href="../reference/calibrate_outputs.html">calibrate_outputs()</a></code> if user tries to calibrate an ouptut package that has already been calibrated. This is determined by whether the <code>output$spectrum_calibration</code> table exists in the output object. <em>In future, it would be nicer to allow user to re-calibrate an output package. This will require saving additional information to un-calibrate and re-calibrate.</em></p></li>
<li><p>Save calibrated count outputs at Spectrum region level in the <code>spectrum_calibration.csv</code> outputs.</p></li>
<li><p>Add function <code>hintr_calibrate_plot</code> to return data for plotting calibrate barchart.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.5" id="naomi-255">naomi 2.5.5<a class="anchor" aria-label="anchor" href="#naomi-255"></a></h2>
<ul><li>Add argument <code>na.rm=</code> to <code><a href="../reference/output_package.html">output_package()</a></code> to allow calculation of quantiles if there are missing values in the simulation. Default is <code>na.rm = FALSE</code> and <code>na.rm = TRUE</code> is to be used for debugging purposes only. Cases where missing values occur will usually indicate very poor model fits and issues that need to be addressed.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.4" id="naomi-254">naomi 2.5.4<a class="anchor" aria-label="anchor" href="#naomi-254"></a></h2>
<p>Updates to PEPFAR Data Pack outputs.</p>
<ul><li>Add age groups 50-54, 55-59, 60-64, 65+.</li>
<li>Edit format of PEPFAR data pack CSV:
<ul><li>Add column <code>dataelement_uid</code>.</li>
<li>Add <code>=""&lt;&gt;""</code> around age group values.</li>
</ul></li>
<li>Change file name save to <code>pepfar_datapack_indicators_2022.csv</code>.</li>
<li>Separate input data aggregation and plot preparation scripts</li>
<li>Remove <code>time_step</code> and add <code>year</code>, <code>quarter</code> and <code>calendar_quarter</code> in input time series function outputs</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.3" id="naomi-253">naomi 2.5.3<a class="anchor" aria-label="anchor" href="#naomi-253"></a></h2>
<ul><li>Include <code>parent_area_id</code> and <code>area_sort_order</code> in input time series function outputs</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.2" id="naomi-252">naomi 2.5.2<a class="anchor" aria-label="anchor" href="#naomi-252"></a></h2>
<ul><li>Add function <code>get_plot_type_label_and_description</code> to get label and description for each input time series plot types.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.1" id="naomi-251">naomi 2.5.1<a class="anchor" aria-label="anchor" href="#naomi-251"></a></h2>
<ul><li>Add functions <code>prepare_input_time_series_art</code> and <code>prepare_input_time_series_anc</code> for returning ART and ANC data formatted for plotting input time series graphs.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.5.0" id="naomi-250">naomi 2.5.0<a class="anchor" aria-label="anchor" href="#naomi-250"></a></h2>
<ul><li>Add functions <code>hintr_prepare_spectrum_download</code>, <code>hintr_prepare_coarse_age_group_download</code> and <code>hintr_prepare_summary_report_download</code> for generating downloads from <code>hintr_output</code> object</li>
<li>Refactor <code>hintr_run_model</code> and <code>hintr_calibrate</code> to save out minimal data</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.4.2" id="naomi-242">naomi 2.4.2<a class="anchor" aria-label="anchor" href="#naomi-242"></a></h2>
<ul><li>Add Portuguese translations</li>
<li>Move summary plot functions into naomi package</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.4.1" id="naomi-241">naomi 2.4.1<a class="anchor" aria-label="anchor" href="#naomi-241"></a></h2>
<ul><li>Manually skip ‘PSNU not found warning’ in <code><a href="../reference/write_datapack_csv.html">write_datapack_csv()</a></code> when running <code><a href="../reference/hintr_run_model.html">hintr_run_model()</a></code> with zone-level demo data. This occurs because the demo data have ISO3 = <code>MWI</code> for which the PSNU level is 3, but demo zone-level model fits are only applied to levels 0:2. A better solution would be to change the ISO3 for the demo data to something artificial, but this requires relaxing some validation in the user interface first.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.4.0" id="naomi-240">naomi 2.4.0<a class="anchor" aria-label="anchor" href="#naomi-240"></a></h2>
<ul><li>Add demo datasets for subnational Spectrum files for three Malawi regions (Northern, Central, Southern).</li>
<li>Add zone-level demo datasets population, ART, and ANC testing datasets.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.15" id="naomi-2315">naomi 2.3.15<a class="anchor" aria-label="anchor" href="#naomi-2315"></a></h2>
<ul><li>Updates to summary report</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.14" id="naomi-2314">naomi 2.3.14<a class="anchor" aria-label="anchor" href="#naomi-2314"></a></h2>
<ul><li>Add alternate example survey data using data from MDHS 2015-16 survey final report.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.13" id="naomi-2313">naomi 2.3.13<a class="anchor" aria-label="anchor" href="#naomi-2313"></a></h2>
<ul><li>Option to output summary report in French.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.12" id="naomi-2312">naomi 2.3.12<a class="anchor" aria-label="anchor" href="#naomi-2312"></a></h2>
<ul><li>Fix to summary report to display input ANC data in description.</li>
<li>Ensure summary report pulls most recent calibration options.</li>
<li>Fix <code>validate_calibration_options()</code> typo.</li>
<li>Add <code>option$calibrate_method</code> back into the summary report.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.11" id="naomi-2311">naomi 2.3.11<a class="anchor" aria-label="anchor" href="#naomi-2311"></a></h2>
<ul><li>Add PEPFAR PSNU ID mapping for MLI, SEN, LBR, GHA, SLE.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.10" id="naomi-2310">naomi 2.3.10<a class="anchor" aria-label="anchor" href="#naomi-2310"></a></h2>
<ul><li>Add description text for ADR upload to model output metadata.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.9" id="naomi-239">naomi 2.3.9<a class="anchor" aria-label="anchor" href="#naomi-239"></a></h2>
<ul><li>Add PEPFAR PSNU level for BFA to level 1.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.8" id="naomi-238">naomi 2.3.8<a class="anchor" aria-label="anchor" href="#naomi-238"></a></h2>
<ul><li>Ensure that log interpolation is non-negative values only by inserting <code>pmax(..., 0)</code> in function <code>log_lin_approx()</code>. (NAOMI TROUBLESHOOTING #100)</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.7" id="naomi-237">naomi 2.3.7<a class="anchor" aria-label="anchor" href="#naomi-237"></a></h2>
<ul><li>When selecting ART data in <code><a href="../reference/artnum_mf.html">artnum_mf()</a></code>, if exact ART quarter is found in the data, filter those data instead of interpolating. This is more efficient and avoids interpolation error if only a single quarter of data are uploaded.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.6" id="naomi-236">naomi 2.3.6<a class="anchor" aria-label="anchor" href="#naomi-236"></a></h2>
<ul><li>If ART data are not available at both times, do not estimate overall or district-level change in ART coverage. Previously this was only restricted if there were no ART at Time 2; not the case where ART at time 2 but not at time 1.</li>
<li>It no sex-stratified ART data from any source, do not estimate difference between adult female and male ART coverage.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.5" id="naomi-235">naomi 2.3.5<a class="anchor" aria-label="anchor" href="#naomi-235"></a></h2>
<ul><li>Add PEPFAR Datim UID for Angola.&lt;</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.4" id="naomi-234">naomi 2.3.4<a class="anchor" aria-label="anchor" href="#naomi-234"></a></h2>
<ul><li>Hotfix: remove <code>option$calibrate_method</code> from summary report (naomi troubleshooting #76).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.3" id="naomi-233">naomi 2.3.3<a class="anchor" aria-label="anchor" href="#naomi-233"></a></h2>
<ul><li>Update naomi summary report</li>
<li>Switch to brio for file reading to avoid encoding issues on windows</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.2" id="naomi-232">naomi 2.3.2<a class="anchor" aria-label="anchor" href="#naomi-232"></a></h2>
<ul><li>Add PEPFAR Datim UID for Uganda Arua and Terego districts.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.1" id="naomi-231">naomi 2.3.1<a class="anchor" aria-label="anchor" href="#naomi-231"></a></h2>
<ul><li>Set default for <code>calibrate_method</code> model option in user interface via JSON metadata.</li>
<li>Fix swapped indicator_code and indicator_id for Data Pack metadata which were swapped.</li>
<li>Refactor [<code><a href="../reference/calibrate_outputs.html">calibrate_outputs()</a></code>]; handle uncertainty ranges for proportion adjustments.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.3.0" id="naomi-230">naomi 2.3.0<a class="anchor" aria-label="anchor" href="#naomi-230"></a></h2>
<ul><li>Implement ‘logistic’ scaling option for [<code><a href="../reference/calibrate_outputs.html">calibrate_outputs()</a></code>] such that estimates are adjusted on logistic scale by fine district/sex/age group to ensure proportions do not go above 100%.
<ul><li>Note: implementation does not yet handle uncertainty ranges. Those might still go above 100%.</li>
</ul></li>
<li>Fix to model calibration for number aware of status to align with proportion aware of status and number unaware of status.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.5" id="naomi-225">naomi 2.2.5<a class="anchor" aria-label="anchor" href="#naomi-225"></a></h2>
<ul><li>Add BWA, HTI, and COD to PEPFAR Data Pack PSNU list</li>
<li>Fix Datim data element UID for indicator DIAGNOSED_SUBNAT.T_1.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.4" id="naomi-224">naomi 2.2.4<a class="anchor" aria-label="anchor" href="#naomi-224"></a></h2>
<ul><li>hintr_calibrate will store calibration outputs to new files instead of overwriting existing</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.3" id="naomi-223">naomi 2.2.3<a class="anchor" aria-label="anchor" href="#naomi-223"></a></h2>
<ul><li>Add BEN to PEPFAR Data Pack PSNU list.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.2" id="naomi-222">naomi 2.2.2<a class="anchor" aria-label="anchor" href="#naomi-222"></a></h2>
<ul><li>Fix summary report map colour scales</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.1" id="naomi-221">naomi 2.2.1<a class="anchor" aria-label="anchor" href="#naomi-221"></a></h2>
<ul><li>Update French translation strings supplied by UNAIDS.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.2.0" id="naomi-220">naomi 2.2.0<a class="anchor" aria-label="anchor" href="#naomi-220"></a></h2>
<ul><li><p>Implement survey data likelihood as flexible aggregation over areas / sex / age groups, similar to likelihood for number on ART and ANC testing.</p></li>
<li>
<p>Adjust flexibility of random effects specification based on granularity of available survey data when using aggregate survey data.</p>
<ul><li>If only age 15-49 data are available, do not estimate age effects; use Spectrum odds ratio as offset pattern for all ages.</li>
<li>If only both sexes data are available, do not estimate district x sex interaction.</li>
</ul></li>
<li><p>Add <em>advanced</em> model option <code>use_survey_aggregate</code> to select use of aggregate uploaded survey dataset.</p></li>
<li>
<p>Reparameterise random effects to be scaled to the linear predictor, as implemented by INLA parameterisation. That is now: mu = beta0 + u_i; u_i ~ N(0, sigma) instead of the previous parameterisation: mu = beta0 + u_i * sigma; u_i ~ N(0, 1).</p>
<p>This does not change the model at all, reduces the fitting time noticeably because the starting values for the linear predictor for the ‘inner optimisation’ step do not change resulting from steps in the hyperparameters.</p>
<p>Implementation for the BYM2 model follows the sparsity preserving conditional parameterisation described by Riebler <em>et al.</em> in Section 3.4.</p>
</li>
<li>
<p>Update PEPFAR Data Pack export:</p>
<ul><li>Only return future projection outputs except for <code>art_current</code> for current estimates.</li>
<li>Manually code <code>art_current</code> at current estimates as indicator_code <code>TX_CURR_SUBNAT.R</code>.</li>
<li>Return number aware of status instead of proportion aware of status (DIAGNOSED_SUBNAT.T_1).</li>
</ul></li>
<li><p>Update CIV Datim UID mapping for new 113 health districts.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.14" id="naomi-2114">naomi 2.1.14<a class="anchor" aria-label="anchor" href="#naomi-2114"></a></h2>
<ul><li>Add calibration options back in, reverts 2.1.8 changes</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.13" id="naomi-2113">naomi 2.1.13<a class="anchor" aria-label="anchor" href="#naomi-2113"></a></h2>
<ul><li>Report progress back from calibration</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.12" id="naomi-2112">naomi 2.1.12<a class="anchor" aria-label="anchor" href="#naomi-2112"></a></h2>
<ul><li>Update dependency first90 v1.4.2 which ensures backwards compatibility for previous .shiny90 files.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.11" id="naomi-2111">naomi 2.1.11<a class="anchor" aria-label="anchor" href="#naomi-2111"></a></h2>
<ul><li>Catch error if output package construction returns NA error when calculating quantiles and return the REPORTed indicator that threw error (#180).</li>
<li>Replace unaware_untreated_prop = 1.0 if ART coverage is 100% in a particular Spectrum age group (support ticket 11).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.10" id="naomi-2110">naomi 2.1.10<a class="anchor" aria-label="anchor" href="#naomi-2110"></a></h2>
<ul><li>Fix new infections scaling. In plotting outputs number of new infections were being inadvertently scaled x100 (reported by Lesotho estimates team).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.9" id="naomi-219">naomi 2.1.9<a class="anchor" aria-label="anchor" href="#naomi-219"></a></h2>
<ul><li>Increase eppasm dependency to 0.5.9.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.8" id="naomi-218">naomi 2.1.8<a class="anchor" aria-label="anchor" href="#naomi-218"></a></h2>
<ul><li>Hotfix to move calibration options back to model run. Calibration is too slow to run synchronously and is meaning no other users can use the application whilst calibration is being run - we will disable async calibration in hintr.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.7" id="naomi-217">naomi 2.1.7<a class="anchor" aria-label="anchor" href="#naomi-217"></a></h2>
<ul><li>In model options:
<ul><li>Select most recent household survey for prevalence based on survey_mid_calendar_quarter</li>
<li>Select most recent household survey for art_coverage if data exist</li>
<li>If ANC data exist in the most recent survey year [defaulted for prevalence], default select that year for Time 1 (both prevalence and ART coverage). If no data in that year, do not select default</li>
<li>If ANC data exist in the year 2020, preselect that for ‘Time 2’ in ANC clients, ANC prevalence, and ANC coverage.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.6" id="naomi-216">naomi 2.1.6<a class="anchor" aria-label="anchor" href="#naomi-216"></a></h2>
<ul><li>Summary report logic error corrected</li>
<li>Patch front end issue if anc_clients_year2 is selected and unselected, resulting in <code>anc_clients_year2</code> passed to model.</li>
<li>Patch issue arising if no ART data is uploaded and R gets confused about an option not supplied due to autocompletion of list$name.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.5" id="naomi-215">naomi 2.1.5<a class="anchor" aria-label="anchor" href="#naomi-215"></a></h2>
<ul><li>Summary report updated to handle model options from naomi web application</li>
<li>Calibration options unscrambled in get_model_calibration_options() test</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.4" id="naomi-214">naomi 2.1.4<a class="anchor" aria-label="anchor" href="#naomi-214"></a></h2>
<ul><li>Add final number of iterations and duration to model fit progress message.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.3" id="naomi-213">naomi 2.1.3<a class="anchor" aria-label="anchor" href="#naomi-213"></a></h2>
<div class="section level4">
<h4 id="awareness-of-hiv-status-2-1-3">Awareness of HIV status<a class="anchor" aria-label="anchor" href="#awareness-of-hiv-status-2-1-3"></a></h4>
<ul><li><p>If a .shiny90 file is included, the <em>first90</em> package is used to calculate the proportion of untreated PLHIV who are aware of their HIV status by sex and age group.</p></li>
<li><p>To estimate the proportion aware of status at the district, this proportion is applied to the estimated untreated population in each district. This is added to the ART coverage to estimate the total proportion aware of status at district level by age and sex.</p></li>
<li>
<p>New output indicators for awarness of HIV status:</p>
<ul><li>
<code>untreated_plhiv_num</code>: Number of untreated PLHIV (the ‘treatment gap’).</li>
<li>
<code>aware_plhiv_prop</code>: Proportion of PLHIV aware of HIV positive status (‘first 90’ indicator).</li>
<li>
<code>unaware_plhiv_num</code>: Number of PLHIV who are not aware of their HIV positive status.</li>
</ul></li>
<li><p>Add model option <code>output_aware_plhiv</code> in ‘Advanced options’. If no <code>.shiny90</code> file is present in the PJNZ, this must be set to <code>FALSE</code>. An error is raised by <code><a href="../reference/validate_model_options.html">validate_model_options()</a></code> prompting this if no <code>.shiny90</code> file is found inside the PJNZ.</p></li>
</ul></div>
<div class="section level4">
<h4 id="pepfar-data-pack-2-1-3">PEPFAR Data Pack<a class="anchor" aria-label="anchor" href="#pepfar-data-pack-2-1-3"></a></h4>
<ul><li>Update PEFPAR datapack export to conform to 2021 Data Pack specification.</li>
</ul></div>
<div class="section level4">
<h4 id="additional-changes-2-1-3">Additional changes<a class="anchor" aria-label="anchor" href="#additional-changes-2-1-3"></a></h4>
<ul><li>Update demo datasets to distinguish clearly from Malawi. Rename files as <code>demo_</code> and affix <code>_demo</code> to the end of the area IDs.</li>
<li>Add argument <code>quantile(..., names = FALSE)</code> in the funciton <code>add_stats()</code> for computation of posterior quantiles. This gives a decent speedup in producing the outptus package.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.2" id="naomi-212">naomi 2.1.2<a class="anchor" aria-label="anchor" href="#naomi-212"></a></h2>
<ul><li>Make running input validation during model run optional</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.1" id="naomi-211">naomi 2.1.1<a class="anchor" aria-label="anchor" href="#naomi-211"></a></h2>
<ul><li>Make ‘Advanced Options’ panel on model options page collapsible by default</li>
<li>Add option for outputting awareness of HIV status in ‘Advanced options’.</li>
<li>Change “Population calibration options” to “Population calibration” for consistent with other block labels.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.1.0" id="naomi-210">naomi 2.1.0<a class="anchor" aria-label="anchor" href="#naomi-210"></a></h2>
<p>This release revises the modelling of ANC prevalence and ART coverage and produces outputs for district-level ANC testing cascade.</p>
<div class="section level4">
<h4 id="anc-testing-cascade-2-1-0">ANC testing cascade<a class="anchor" aria-label="anchor" href="#anc-testing-cascade-2-1-0"></a></h4>
<ul><li><p>Add ANC bias parameters to age-specific prevalence and ART coverage regression equations instead of to aggregate ANC prevalence and ART coverage.</p></li>
<li><p>ANC prevalence and ANC ART coverage outputs are produced by five-year age group, 15-24, 25-34, 35-49, and all ages.</p></li>
<li>
<p>New output indicators for ANC testing cascade:</p>
<ul><li>
<code>anc_clients</code>: Number of ANC1 clients.</li>
<li>
<code>anc_plhiv</code>: Number of HIV positive ANC attendees.</li>
<li>
<code>anc_already_art</code>: Number of ANC clients already on ART prior to first ANC visit.</li>
<li>
<code>anc_art_new</code>: Number of HIV positive ANC attendees initiating ART.</li>
<li>
<code>anc_known_pos</code>: Number of HIV positive ANC attendees aware of HIV status prior to first ANC.</li>
<li>
<code>anc_tested_pos</code>: Number of HIV positive ANC attendees tested HIV positive during ANC.</li>
<li>
<code>anc_known_pos</code>: Number of HIV negative ANC attendees.</li>
</ul><p>Currently these indicators are calculated assuming that the number of ‘known positive’ ANC attendees are the same as the number already on ART.</p>
</li>
<li>
<p>Added a likelihood for the number of ANC clients observed in current year as a function of district population size, age-specific ferility rate (fixed inputs), and a district-level random effect to scale overall fertility rate.</p>
<ul><li>The number of months reflected in ANC client reporting is used as an offset for the number of clients such that predicted number of clients are projected annual total.</li>
<li>Results explicitly represent <strong>number of ANC clients</strong>, calibrated based on the number in the current year data. No distinction between number of births versus ANC clients are made. Results should not be used for estimating PMTCT coverage (for example).</li>
<li>Currently only a single time point is used for ANC clients estimates and projections. The future projection is closely linked to the accuracy of current year data; uncertainty around the estimate and projection are not appropriately quantified.</li>
</ul></li>
<li><p>Age-specific fertility rate ratios (FRR) for HIV positive relative to HIV negative pregnant women and women already on ART relative to untreated HIV positive women are calculated from Spectrum model outputs (using EPP-ASM simulation) and included in regression equations for ANC prevalence and ANC ART coverage, respectively.</p></li>
<li>
<p>Aggregation of ANC testing data observations generalized using same approach as aggregation of number currently on ART observations. This means that:</p>
<ul><li>ANC testing observations can be input for coarser areas, for example admin 1.</li>
<li>Age-stratified ANC testing data can be input, for example 5-year age groups.</li>
</ul><p>Age-stratified ANC testing do not yet inform national or district level estimates for age-specific fertility or HIV/ART fertility rate ratios.</p>
</li>
</ul><p>Additional changes:</p>
<ul><li><p>Use Kish effective sample size in likelihood for household survey data.</p></li>
<li><p>Update summary report with additional styling, number formatting, and methods overview.</p></li>
<li><p>Streamline function <code><a href="../reference/extract_pjnz_naomi.html">extract_pjnz_naomi()</a></code> to reduce the number of calls to unzip and read .DP file by getting all outputs from [<code>eppasm::read_hivproj_output()</code>] which was utilised; remove dependency on <code>specio</code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.7" id="naomi-207">naomi 2.0.7<a class="anchor" aria-label="anchor" href="#naomi-207"></a></h2>
<ul><li>Slight text edits to ANC model options block labels.</li>
<li>Add <code>area_name</code> field to example datasets, conforming to ADR schemas.</li>
<li>Remove survey data preparation functions. Added to <code>naomi.utils</code> package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.6" id="naomi-206">naomi 2.0.6<a class="anchor" aria-label="anchor" href="#naomi-206"></a></h2>
<ul><li>Updates to ‘Model Options’ page in Naomi application:
<ul><li>Update default ‘current estimates’ calendar quarter to December 2020.</li>
<li>Move ‘short-term projections’ calendar quarter to General options block.</li>
<li>Add drop down to select ‘number of months’ included in ANC testing data reporting.</li>
<li>Add select option to use Kish design effect in survey data likelihood.</li>
<li>Select most recent <code>survey_mid_calendar_quarter</code> as survey run option.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.5" id="naomi-205">naomi 2.0.5<a class="anchor" aria-label="anchor" href="#naomi-205"></a></h2>
<ul><li>Report iteration number and elapsed time from model fit</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.4" id="naomi-204">naomi 2.0.4<a class="anchor" aria-label="anchor" href="#naomi-204"></a></h2>
<ul><li>Tidy model options layout and tooltip text</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.3" id="naomi-203">naomi 2.0.3<a class="anchor" aria-label="anchor" href="#naomi-203"></a></h2>
<ul><li>Remove utility functions for creating area datasets: <code>check_boundaries()</code>, <code>compare_boundaries()</code>, and <code>gather_areas()</code>.</li>
<li>Add <code>area_name</code> field to survey indicators dataset prepared by <code>calc_survey_indicators()</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.2" id="naomi-202">naomi 2.0.2<a class="anchor" aria-label="anchor" href="#naomi-202"></a></h2>
<ul><li>Supply default <code>"none"</code> calibration options in <code><a href="../reference/hintr_run_model.html">hintr_run_model()</a></code> if calibration options are not specified in the options list.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.1" id="naomi-201">naomi 2.0.1<a class="anchor" aria-label="anchor" href="#naomi-201"></a></h2>
<ul><li>Remove calibration options from model run options</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="2.0.0" id="naomi-200">naomi 2.0.0<a class="anchor" aria-label="anchor" href="#naomi-200"></a></h2>
<p>Version 2.0 established for 2021 UNAIDS estimates. Changes are not guaranteed to be backward compatible with 2020 version of Naomi model.</p>
<ul><li>Update age group codes to <code>YXXX_XXX</code>.</li>
<li>Chage <code>age_group_label</code> from 00-04 to 0-4 and 05-09 to 5-9.</li>
<li>Remove <code>age_group_id</code>, <code>indicator_id</code>, and <code>quarter_id</code> column from output package.</li>
<li>Rename columns in datasets for consistency with Fjelltop UNAIDS data inputs package:
<ul><li>ANC testing dataset: <code>ancrt_*</code> changed to <code>anc_*</code>.</li>
<li>ART programme data: <code>current_art</code> changed to <code>art_current</code> and <code>art_new</code> column added.</li>
<li>Survey HIV indicators: make several column names more human readable.</li>
</ul></li>
<li>Add Kish effective sample size approximation (<code>sum(weights) ^ 2 / sum(weights ^ 2)</code>) to survey indicators dataset in field <code>n_eff_kish</code>.</li>
<li>Harmonise indicator names in survey dataset with outputs (<code>prevalence</code>, <code>art_coverage</code>).</li>
<li>Rename calculated ANC input indicators to <code>anc_prevalence</code> and <code>anc_art_coverage</code>.</li>
<li>Harmonise ART number output indicators with ART input data indicators:
<ul><li>
<code>art_num_attend</code> becomes <code>art_current</code>.</li>
<li>
<code>art_num_residents</code> becomes <code>art_current_residents</code>.</li>
</ul></li>
</ul><p>Internal changes:</p>
<ul><li>Move several metadata tables to CSV tables saved in <code>inst/metadata/</code> rather than scripted functions.
<ul><li>
<code>meta_age_group.csv</code> accessed by <code><a href="../reference/get_age_groups.html">get_age_groups()</a></code>.</li>
<li>
<code>meta_indicator.csv</code> accessed by <code><a href="../reference/get_meta_indicator.html">get_meta_indicator()</a></code>.</li>
<li>Data Pack ID mapping tables: <code>datapack_indicator_mapping.csv</code>, <code>datapack_agegroup_mapping.csv</code>, <code>datapack_sex_mapping.csv</code>.</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.11" id="naomi-1011">naomi 1.0.11<a class="anchor" aria-label="anchor" href="#naomi-1011"></a></h2>
<ul><li>Add a basic vignette showing example script for running <code><a href="../reference/hintr_run_model.html">hintr_run_model()</a></code> for reproducing web app workflow.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.10" id="naomi-1010">naomi 1.0.10<a class="anchor" aria-label="anchor" href="#naomi-1010"></a></h2>
<ul><li>Edit <code>summary_report.Rmd</code> to remove <code>age_group_id</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.9" id="naomi-109">naomi 1.0.9<a class="anchor" aria-label="anchor" href="#naomi-109"></a></h2>
<ul><li>Add summary_report_path to model run for saving summary report</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.8" id="naomi-108">naomi 1.0.8<a class="anchor" aria-label="anchor" href="#naomi-108"></a></h2>
<ul><li>Avoid segfault in <code><a href="../reference/sample_tmb.html">sample_tmb()</a></code> when redoing the sampling with different TMB configuration (different computer/number of set threads) by recreating the pointers if they are missing using <code>obj$retape()</code>.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.7" id="naomi-107">naomi 1.0.7<a class="anchor" aria-label="anchor" href="#naomi-107"></a></h2>
<ul><li>Return indicator formatting metadata in <code><a href="../reference/get_metadata.html">get_metadata()</a></code> and <code><a href="../reference/get_plotting_metadata.html">get_plotting_metadata()</a></code>
</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.6" id="naomi-106">naomi 1.0.6<a class="anchor" aria-label="anchor" href="#naomi-106"></a></h2>
<ul><li>Import sparse matrix multiplication <code>%*%</code> from <code>Matrix</code> package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.5" id="naomi-105">naomi 1.0.5<a class="anchor" aria-label="anchor" href="#naomi-105"></a></h2>
<ul><li>Add <code><a href="../reference/hintr_calibrate.html">hintr_calibrate()</a></code> which takes output and calibration options and runs calibration and returns in hintr output format</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.4" id="naomi-104">naomi 1.0.4<a class="anchor" aria-label="anchor" href="#naomi-104"></a></h2>
<ul><li>Rename summary_path in model run args to coarse_output_path to be more representative of actual output (in preparation for adding summary report)</li>
<li>Add <code>get_calibration_options()</code> to retrieve options for calibration</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.2" id="naomi-102">naomi 1.0.2<a class="anchor" aria-label="anchor" href="#naomi-102"></a></h2>
<ul><li>Patch to <code><a href="../reference/sample_tmb.html">sample_tmb()</a></code> for R 4.0 changes.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="1.0.0" id="naomi-100">naomi 1.0.0<a class="anchor" aria-label="anchor" href="#naomi-100"></a></h2>
<ul><li>Move tmbstan and INLA models to naomi.extensions repo as they add heavyweight dependencies which are not required for the main model to run</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.72" id="naomi-0072">naomi 0.0.72<a class="anchor" aria-label="anchor" href="#naomi-0072"></a></h2>
<ul><li>Added function <code><a href="../reference/create_adj_matrix.html">create_adj_matrix()</a></code> to create an adjacency matrix from a shape file.</li>
<li>Added function <code><a href="../reference/scale_gmrf_precision.html">scale_gmrf_precision()</a></code> to scale precision matrix such that geometric mean of marginal variance is one. This mirrors the behaviour of <code>INLA::inla.scale.model()</code>.</li>
<li>Remove dependency on INLA package. Now prompted to install if <code>fit_inla()</code> is called and the package is not found.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.71" id="naomi-0071">naomi 0.0.71<a class="anchor" aria-label="anchor" href="#naomi-0071"></a></h2>
<ul><li>Use <code>rdhs::download_boundaries()</code> in script <code>data-raw/survey.R</code>. (No change to model or datasets.)</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.70" id="naomi-0070">naomi 0.0.70<a class="anchor" aria-label="anchor" href="#naomi-0070"></a></h2>
<ul><li>Use summary output download function to download a Naomi output package with coarse age groups only: 15-49, 15-64, 15+, 50+, 00+, 00-64, 00-14, 15-24, 25-34, 35-49, 50-64, 65+.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.69" id="naomi-0069">naomi 0.0.69<a class="anchor" aria-label="anchor" href="#naomi-0069"></a></h2>
<ul><li>Add functions <code><a href="../reference/subset_output_package.html">subset_output_package()</a></code> to subset and re-save a zipped Naomi output package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.68" id="naomi-0068">naomi 0.0.68<a class="anchor" aria-label="anchor" href="#naomi-0068"></a></h2>
<ul><li>Pass some metadata back from model run for use in output formatting</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.67" id="naomi-0067">naomi 0.0.67<a class="anchor" aria-label="anchor" href="#naomi-0067"></a></h2>
<ul><li>Allow passing input data to <code>naomi_run_model</code> either as list of file paths or list of lists each containing a path, hash and filename</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.66" id="naomi-0066">naomi 0.0.66<a class="anchor" aria-label="anchor" href="#naomi-0066"></a></h2>
<ul><li>Allow fitting to ART data to aggregated areas. There is a check that the same model area is not included in more than on area in the ART dataset.</li>
<li>Use logit offsets for ages below which survey data are available. This is principally used for age 0-14 when survey data start at age 15.</li>
<li>Add option <code>rho_paed_15to49f_ratio</code> to calculate paediatric prevalence as ratio of female 15-49 adult prevalence.</li>
<li>Recode string is passed by JSON for ANC testing data year as NULL.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.65" id="naomi-0065">naomi 0.0.65<a class="anchor" aria-label="anchor" href="#naomi-0065"></a></h2>
<ul><li>Fix error in default option for time-varying ART attendance model option in 0.0.64 release.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.64" id="naomi-0064">naomi 0.0.64<a class="anchor" aria-label="anchor" href="#naomi-0064"></a></h2>
<ul><li>Area random effect for prevalence below age 15 interaction as ICAR model. Implemented as option <code>rho_paed_x_term</code> specified by argument <code>naomi_model_frame(..., rho_paed_x_term = TRUE, ...)</code>. Defaualt value is <code>FALSE</code>.</li>
<li>Initialize hyperparameters at prior mode.</li>
<li>Add calibration option for new infections to Spectrum new infections.</li>
<li>Update default Spectrum calibration option to “national”.</li>
<li>Update default time-varying ART attendance “yes”.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.63" id="naomi-0063">naomi 0.0.63<a class="anchor" aria-label="anchor" href="#naomi-0063"></a></h2>
<ul><li>Change age_group_label for ages 0-4 and 5-9 to 00-04 and 05-09 for Data Pack.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.62" id="naomi-0062">naomi 0.0.62<a class="anchor" aria-label="anchor" href="#naomi-0062"></a></h2>
<ul><li>Better error messages with pjnz/geojson mismatch</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.61" id="naomi-0061">naomi 0.0.61<a class="anchor" aria-label="anchor" href="#naomi-0061"></a></h2>
<ul><li>Add country-specific colour scales for WCA countries.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.57" id="naomi-0057">naomi 0.0.57<a class="anchor" aria-label="anchor" href="#naomi-0057"></a></h2>
<p>Formatting updates requested for Data Pack 2019:</p>
<ul><li>Change age_group_label for ages &lt;1 and 1-4 to &lt;01 and 01-04.</li>
<li>Change dataelement UIDs for TX_CURR_SUBNAT and PLHIV.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.56" id="naomi-0056">naomi 0.0.56<a class="anchor" aria-label="anchor" href="#naomi-0056"></a></h2>
<ul><li>Replace <code>survey_year</code> with <code>survey_mid_calendar_quarter</code> in the survey indicators dataset.</li>
<li>Add column <code>restype</code> for urban/rural to survey indicators datasets and option to stratify survey indicators calculation by urban/rural.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.55" id="naomi-0055">naomi 0.0.55<a class="anchor" aria-label="anchor" href="#naomi-0055"></a></h2>
<ul><li>Option for time-varying ART attendance odds ratio. The option <code>artattend_t2</code> can be set to TRUE if there is evidence that patterns of cross-district ART attendance changed for the period before the survey and the inter-survey period.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.54" id="naomi-0054">naomi 0.0.54<a class="anchor" aria-label="anchor" href="#naomi-0054"></a></h2>
<ul><li>Add output stratification for age groups &lt;1, 1-4. This is simply disaggregated based on proportions from Spectrum with now uncertainty.</li>
<li>Add function <code>export_datapack()</code> to export an output package to datapack CSV format.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.53" id="naomi-0053">naomi 0.0.53<a class="anchor" aria-label="anchor" href="#naomi-0053"></a></h2>
<ul><li>Do not calculate reported output aggregations during model fitting. This should modestly reduce model objective function computation time.</li>
<li>Output projection to a third calendar quarter. Projection outputs are computed after objective function calcuation. Predicted ANC attendance at time 3 is not computed.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.52" id="naomi-0052">naomi 0.0.52<a class="anchor" aria-label="anchor" href="#naomi-0052"></a></h2>
<ul><li>Automatically remove rows with all NA values in <code>read_*()</code> functions.</li>
<li>Remove extraneous argument area_merged from output.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.51" id="naomi-0051">naomi 0.0.51<a class="anchor" aria-label="anchor" href="#naomi-0051"></a></h2>
<ul><li>Add optional approximate design effect to scale effective sample size for survey prevalence, art coverage, and proportion recent observations.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.50" id="naomi-0050">naomi 0.0.50<a class="anchor" aria-label="anchor" href="#naomi-0050"></a></h2>
<ul><li>Add spatial interaction to ART coverage model for &lt;15 / 15+ to allow different paediatric vs. adult ART coverage and different change in paediatric coverage. This reduces paediatric ART data distorting adult model results.</li>
<li>ART number dataset accepts either year or calendar_quarter column.</li>
<li>Linearly interpolate number on ART for model fitting. If desired quarter is before earliest data, the earliest ART number may be carried backward by up to four quarters. Number on ART are never carried forwards.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.49" id="naomi-0049">naomi 0.0.49<a class="anchor" aria-label="anchor" href="#naomi-0049"></a></h2>
<ul><li>Properly age new infections between time 1 and time 2 based on ageing and incidecne trend from Spectrum.</li>
<li>Add new paediatric HIV infections betwen time 1 and time 2 proportional to HIV survivors by age and prevalence among women age 15-49 in Spectrum.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.48" id="naomi-0048">naomi 0.0.48<a class="anchor" aria-label="anchor" href="#naomi-0048"></a></h2>
<ul><li>Add default values for area level and calendar quarter to generate estiamtes for</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.47" id="naomi-0047">naomi 0.0.47<a class="anchor" aria-label="anchor" href="#naomi-0047"></a></h2>
<ul><li>Add read_***() functions with col_type parsers.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.46" id="naomi-0046">naomi 0.0.46<a class="anchor" aria-label="anchor" href="#naomi-0046"></a></h2>
<ul><li>Add TMB-Stan model fitting, with and without Laplace approximation.</li>
<li>Add INLA model fitting.</li>
</ul><p>This is for development and comparison purposes, not for production use.</p>
</div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.45" id="naomi-0045">naomi 0.0.45<a class="anchor" aria-label="anchor" href="#naomi-0045"></a></h2>
<ul><li>Remove age_group_id, indicator_id, and quarter_id from model frames; use human readable age_group, indicator, and calendar_quarter everywhere.</li>
<li>Output number of ART attendees between every district pair. Currently output at estimation level only.</li>
<li>spread_areas() allows an sf object as argument and returns boundaries for wide format areas if provided.</li>
<li>No sex differences in prevalence, ART coverage, or incidence for age below 15 years.</li>
<li>Cap Spectrum ART coverage between 0.001 and 0.999 to avoid logit transformation NaN errors.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.44" id="naomi-0044">naomi 0.0.44<a class="anchor" aria-label="anchor" href="#naomi-0044"></a></h2>
<ul><li>Change ART indicator labels to “ART Number (residents)” and “ART Number (attending)”.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.43" id="naomi-0043">naomi 0.0.43<a class="anchor" aria-label="anchor" href="#naomi-0043"></a></h2>
<ul><li>Check that esimates quarter (time 2) is greater than survey quarter (time 1).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.42" id="naomi-0042">naomi 0.0.42<a class="anchor" aria-label="anchor" href="#naomi-0042"></a></h2>
<ul><li>Add more translations</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.41" id="naomi-0041">naomi 0.0.41<a class="anchor" aria-label="anchor" href="#naomi-0041"></a></h2>
<ul><li>Separate PLHIV projection and incidence calculation.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.40" id="naomi-0040">naomi 0.0.40<a class="anchor" aria-label="anchor" href="#naomi-0040"></a></h2>
<ul><li>Cap ART coverage by age/sex from Spectrum between 0.1% and 99.9% to avoid logit difference evaluating to +/-Inf.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.39" id="naomi-0039">naomi 0.0.39<a class="anchor" aria-label="anchor" href="#naomi-0039"></a></h2>
<ul><li>Set Mozambique colour scales</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.38" id="naomi-0038">naomi 0.0.38<a class="anchor" aria-label="anchor" href="#naomi-0038"></a></h2>
<ul><li>If there is no ART data at time 2, use logit change in ART coverage between time 1 and time 2 from Spectrum to approximate change in ART coverage. Do not estimate non-identifiable parameters.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.37" id="naomi-0037">naomi 0.0.37<a class="anchor" aria-label="anchor" href="#naomi-0037"></a></h2>
<ul><li>Use Spectrum estimates at time 1 for transmission rate defaults (mrc-1236).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.36" id="naomi-0036">naomi 0.0.36<a class="anchor" aria-label="anchor" href="#naomi-0036"></a></h2>
<ul><li>Reverse order of ANC and ART sections</li>
<li>Move artattend_log_gamma_offset into the advanced section</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.35" id="naomi-0035">naomi 0.0.35<a class="anchor" aria-label="anchor" href="#naomi-0035"></a></h2>
<ul><li>Throw error if trying to fit model at country level (mrc-1233).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.34" id="naomi-0034">naomi 0.0.34<a class="anchor" aria-label="anchor" href="#naomi-0034"></a></h2>
<ul><li>Change quarter labels from range to end quarter (“Jan - Mar 2019” -&gt; “March 2019”).</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.33" id="naomi-0033">naomi 0.0.33<a class="anchor" aria-label="anchor" href="#naomi-0033"></a></h2>
<ul><li>Implement ANC prevalence and ART coverage for all areas.</li>
<li>Add ANC prevalence and ART coverage to indicators outputs. Note: currently this si implemented only for age 15-49 at the level of model fitting. This should enable comparisons with input data. Later this can be extended for higher level aggregations.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.32" id="naomi-0032">naomi 0.0.32<a class="anchor" aria-label="anchor" href="#naomi-0032"></a></h2>
<ul><li>Add receiving ART output indicator</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.31" id="naomi-0031">naomi 0.0.31<a class="anchor" aria-label="anchor" href="#naomi-0031"></a></h2>
<ul><li>Fix validation bug caused by missing programme options</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.30" id="naomi-0030">naomi 0.0.30<a class="anchor" aria-label="anchor" href="#naomi-0030"></a></h2>
<ul><li>Undo ANC prevalence and ART coverage at time 2 which errors for different areas at two time points. Fix coming later.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.29" id="naomi-0029">naomi 0.0.29<a class="anchor" aria-label="anchor" href="#naomi-0029"></a></h2>
<ul><li>Patch model validation for options$include_art_t1 = NULL.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.28" id="naomi-0028">naomi 0.0.28<a class="anchor" aria-label="anchor" href="#naomi-0028"></a></h2>
<ul><li>Model for ANC prevalence and ART coverage at time 2.</li>
<li>Drop ANC observations that have NA for any required inputs.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.27" id="naomi-0027">naomi 0.0.27<a class="anchor" aria-label="anchor" href="#naomi-0027"></a></h2>
<ul><li>Explicit type conversion of integer and logical model options.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.25" id="naomi-0025">naomi 0.0.25<a class="anchor" aria-label="anchor" href="#naomi-0025"></a></h2>
<ul><li>Carry forward / backward interpolated population if uploaded population does not span years required.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.25" id="naomi-0025-1">naomi 0.0.25<a class="anchor" aria-label="anchor" href="#naomi-0025-1"></a></h2>
<ul><li>Remove spectrum calibration option validation – NULLs not handled appropriately.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.24" id="naomi-0024">naomi 0.0.24<a class="anchor" aria-label="anchor" href="#naomi-0024"></a></h2>
<ul><li>Hide placeholder &lt;1 / 1-4 outputs which are not implemented yet.</li>
<li>Handle case where ANC testing provided but no year selected (valid) or where a year is requested not found in data (error) (mrc-1176)</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.23" id="naomi-0023">naomi 0.0.23<a class="anchor" aria-label="anchor" href="#naomi-0023"></a></h2>
<ul><li>Implement pre-fitting calibration to Spectrum population size by sex and 5-year age group.</li>
<li>Implement post-fitting calibration to Spectrum PLHIV and number on ART.</li>
<li>Save Spectrum calibration in <code>fit/spectrum_calibration.csv</code> in the ouput zip download.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.22" id="naomi-0022">naomi 0.0.22<a class="anchor" aria-label="anchor" href="#naomi-0022"></a></h2>
<ul><li>Remove ancrt_hiv_status field from ANC testing dataset.</li>
<li>Add parent_area_id and spectrum_region_code to outputs package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.21" id="naomi-0021">naomi 0.0.21<a class="anchor" aria-label="anchor" href="#naomi-0021"></a></h2>
<ul><li>Revise ART attendance model to be single district level ‘attractiveness’ parameter.</li>
<li>Add model input validation step to hintr_run_model().</li>
<li>Implement random number seed argument to sample_tmb() to return exact same results.</li>
<li>Silent fitting for hintr_run_model() unless option outer_verbose = TRUE or inner_verbose = TRUE.</li>
<li>Specify maximum number of iterations for fit_tmb().</li>
<li>Warning if fit_tmb() convergence error.</li>
<li>hintr_run_model() throw error if convergence error, unless option$permissive = TRUE.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.20" id="naomi-0020">naomi 0.0.20<a class="anchor" aria-label="anchor" href="#naomi-0020"></a></h2>
<ul><li>Add function to return 5 year age groups</li>
<li>Support multiple PJNZ extracts in a zip folder.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.19" id="naomi-0019">naomi 0.0.19<a class="anchor" aria-label="anchor" href="#naomi-0019"></a></h2>
<ul><li>Add age &lt;1 / 1-4 age stratification to outputs.</li>
<li>Add number receiving art in area outputs.</li>
<li>Add ASFR inputs.</li>
<li>Add inputs/options.csv in zipped output package.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.18" id="naomi-0018">naomi 0.0.18<a class="anchor" aria-label="anchor" href="#naomi-0018"></a></h2>
<ul><li>Use odds ratios from Spectrum to model prevalence and ART coverage above age of data availability.</li>
<li>Save metadata alongside model outputs, when run via the hint run entrypoint (mrc-760)</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.17" id="naomi-0017">naomi 0.0.17<a class="anchor" aria-label="anchor" href="#naomi-0017"></a></h2>
<ul><li>Use annual programme data input instead of quarterly.</li>
<li>Add spectrum_region_code to area hierarchy.</li>
<li>Save metadata alongside model outputs, when run via the hint run entrypoint (mrc-760)</li>
<li>Add advanced model run options</li>
<li>Add skeleton of model input validation</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.16" id="naomi-0016">naomi 0.0.16<a class="anchor" aria-label="anchor" href="#naomi-0016"></a></h2>
<ul><li>Move metadata into directory separate from extdata</li>
<li>Add error_low and error_high columns to metadata</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.15" id="naomi-0015">naomi 0.0.15<a class="anchor" aria-label="anchor" href="#naomi-0015"></a></h2>
<ul><li>Allow passing no of samples in model run options</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.14" id="naomi-0014">naomi 0.0.14<a class="anchor" aria-label="anchor" href="#naomi-0014"></a></h2>
<ul><li>Update progress message</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.13" id="naomi-0013">naomi 0.0.13<a class="anchor" aria-label="anchor" href="#naomi-0013"></a></h2>
<ul><li>Set default args for hintr model run function</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.12" id="naomi-0012">naomi 0.0.12<a class="anchor" aria-label="anchor" href="#naomi-0012"></a></h2>
<ul><li>Wrap model run in single function for use in hintr API</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.11" id="naomi-0011">naomi 0.0.11<a class="anchor" aria-label="anchor" href="#naomi-0011"></a></h2>
<ul><li>Fix issues with naomi model run options schema templates</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.10" id="naomi-0010">naomi 0.0.10<a class="anchor" aria-label="anchor" href="#naomi-0010"></a></h2>
<ul><li>Use iso3 to locate country plotting metadata instead of country name</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.9" id="naomi-009">naomi 0.0.9<a class="anchor" aria-label="anchor" href="#naomi-009"></a></h2>
<ul><li>Plotting metadata now returns default if country is missing from config</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.8" id="naomi-008">naomi 0.0.8<a class="anchor" aria-label="anchor" href="#naomi-008"></a></h2>
<ul><li>Iterate model options endpoint to be able to exclude optional data set options</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.7" id="naomi-007">naomi 0.0.7<a class="anchor" aria-label="anchor" href="#naomi-007"></a></h2>
<ul><li>Add function to return model run options template to build front end declaratively</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.6" id="naomi-006">naomi 0.0.6<a class="anchor" aria-label="anchor" href="#naomi-006"></a></h2>
<ul><li>Iterate metadata to include model outputs</li>
<li>Expose get_metadata function for hintr use</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.5" id="naomi-005">naomi 0.0.5<a class="anchor" aria-label="anchor" href="#naomi-005"></a></h2>
<ul><li>Add function to aggregate multiple Spectrum files.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.4" id="naomi-004">naomi 0.0.4<a class="anchor" aria-label="anchor" href="#naomi-004"></a></h2>
<ul><li>Allow use of survey VLS data.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.3" id="naomi-003">naomi 0.0.3<a class="anchor" aria-label="anchor" href="#naomi-003"></a></h2>
<ul><li>Ouput uncertainty ranges based on Monte Carlo simulation from joint covariance matrix of fixed and random effects.</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.2" id="naomi-002">naomi 0.0.2<a class="anchor" aria-label="anchor" href="#naomi-002"></a></h2>
<ul><li>Add function to calculate prevalence and ART coverage from ANC data</li>
</ul></div>
    <div class="section level2">
<h2 class="page-header" data-toc-text="0.0.1" id="naomi-001">naomi 0.0.1<a class="anchor" aria-label="anchor" href="#naomi-001"></a></h2>
<ul><li>Add travis build</li>
</ul></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jeff Eaton.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

